<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet" />

  <style>
    body { background-color: #f0f2f5; font-family: 'Segoe UI', sans-serif; }
    .sidebar { background-color: #1f2937; color: #f3f4f6; min-height: 100vh; width: 240px; position: fixed; padding: 2rem 1rem; }
    .content { margin-left: 240px; padding: 1.5rem; }
    .card { border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; }
    .section-title { display: flex; justify-content: space-between; align-items: center; font-weight: 600; font-size: 1.25rem; margin-top: 2rem; margin-bottom: 1rem; }
  </style>
</head>
<body>

<!-- Sidebar -->
<nav class="sidebar">
  <div class="text-center mb-4">
    <img src="{{ url_for('static', filename='images/logo.jpg') }}" alt="Logo" class="rounded-circle mb-2" width="80" height="80" />
    <h5>Admin Dashboard</h5>
  </div>
  <hr style="border-color: rgba(255,255,255,0.2);" />
  <a href="#"><i class="bi bi-house"></i> Home</a>
  <a href="{{ url_for('logout') }}"><i class="bi bi-box-arrow-right"></i> Logout</a>
</nav>

<!-- Main Content -->
<main class="content">

  <!-- ====== LIVE CLASSES ====== -->
  <div class="section-title">
    Live Classes
    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addLiveClassModal"><i class="bi bi-plus-lg"></i> Add</button>
  </div>
  <div class="row">
    {% for cls in live_classes %}
    <div class="col-md-4">
      <div class="card p-2">
        <h5>{{ cls.title }}</h5>
        <p><strong>Time:</strong> {{ cls.time }}</p>
        <p><strong>Form:</strong> {{ cls.form }}</p>
        <p><strong>Subject:</strong> {{ cls.subject }}</p>
        <a href="{{ cls.link }}" class="btn btn-primary btn-sm">Join</a>
        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editLiveClassModal"
                data-id="{{ cls.id }}" data-title="{{ cls.title }}" data-time="{{ cls.time }}" data-form="{{ cls.form }}" data-subject="{{ cls.subject }}" data-link="{{ cls.link }}">Edit</button>
        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteLiveClassModal"
                data-id="{{ cls.id }}" data-title="{{ cls.title }}">Delete</button>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- ====== MATERIALS ====== -->
  <div class="section-title">
    Materials
    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addMaterialModal"><i class="bi bi-plus-lg"></i> Add</button>
  </div>
  <div class="row">
    {% for mat in revision_materials %}
    <div class="col-md-4">
      <div class="card p-2">
        <h5>{{ mat.title }}</h5>
        <p><strong>Form:</strong> {{ mat.form }}</p>
        <p><strong>Subject:</strong> {{ mat.subject }}</p>
        <a href="{{ mat.link }}" class="btn btn-primary btn-sm">View</a>
        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editMaterialModal"
                data-id="{{ mat.id }}" data-title="{{ mat.title }}" data-form="{{ mat.form }}" data-subject="{{ mat.subject }}" data-link="{{ mat.link }}">Edit</button>
        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteMaterialModal"
                data-id="{{ mat.id }}" data-title="{{ mat.title }}">Delete</button>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- ====== VIDEOS ====== -->
  <div class="section-title">
    Videos
    <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addVideoModal"><i class="bi bi-plus-lg"></i> Add</button>
  </div>
  <div class="row">
    {% for vid in videos %}
    <div class="col-md-4">
      <div class="card p-2">
        <h5>{{ vid.title }}</h5>
        <p><strong>Form:</strong> {{ vid.form }}</p>
        <p><strong>Subject:</strong> {{ vid.subject }}</p>
        <a href="{{ vid.link }}" class="btn btn-primary btn-sm" target="_blank">Watch</a>
        <button class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editVideoModal"
                data-id="{{ vid.id }}" data-title="{{ vid.title }}" data-form="{{ vid.form }}" data-subject="{{ vid.subject }}" data-link="{{ vid.link }}">Edit</button>
        <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteVideoModal"
                data-id="{{ vid.id }}" data-title="{{ vid.title }}">Delete</button>
      </div>
    </div>
    {% endfor %}
  </div>

</main>

<!-- ====== MODALS ====== -->
<!-- Live Class Modals -->
<div class="modal fade" id="addLiveClassModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form action="{{ url_for('add_live_class') }}" method="POST">
      <div class="modal-header"><h5>Add Live Class</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <input class="form-control mb-2" name="title" placeholder="Title" required>
        <input type="datetime-local" class="form-control mb-2" name="time" required>
        <input class="form-control mb-2" name="form" placeholder="Form" required>
        <input class="form-control mb-2" name="subject" placeholder="Subject" required>
        <input type="url" class="form-control mb-2" name="link" placeholder="Link" required>
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-primary">Save</button></div>
    </form>
  </div></div>
</div>

<div class="modal fade" id="editLiveClassModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form method="POST" id="editLiveClassForm">
      <div class="modal-header"><h5>Edit Live Class</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <input type="hidden" id="editClassId" name="class_id">
        <input id="editClassTitle" class="form-control mb-2" name="title" required>
        <input id="editClassTime" type="datetime-local" class="form-control mb-2" name="time" required>
        <input id="editClassForm" class="form-control mb-2" name="form" required>
        <input id="editClassSubject" class="form-control mb-2" name="subject" required>
        <input id="editClassLink" type="url" class="form-control mb-2" name="link" required>
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-warning">Update</button></div>
    </form>
  </div></div>
</div>

<div class="modal fade" id="deleteLiveClassModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
    <form method="GET" id="deleteLiveClassForm">
      <div class="modal-header bg-danger text-white"><h5>Confirm Delete</h5></div>
      <div class="modal-body text-center">
        <input type="hidden" id="deleteClassId">
        <p>Are you sure you want to delete <strong id="deleteClassTitleText"></strong>?</p>
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-danger">Delete</button></div>
    </form>
  </div></div>
</div>

<!-- Material Modals -->
<div class="modal fade" id="addMaterialModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form action="{{ url_for('add_material') }}" method="POST" enctype="multipart/form-data">
      <div class="modal-header"><h5>Add Material</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <input class="form-control mb-2" name="title" placeholder="Title" required>
        <input class="form-control mb-2" name="form" placeholder="Form" required>
        <input class="form-control mb-2" name="subject" placeholder="Subject" required>
        <input class="form-control mb-2" name="link" placeholder="Google Drive Link (Optional)">
        <input class="form-control mb-2" type="file" name="file">
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-primary">Save</button></div>
    </form>
  </div></div>
</div>

<div class="modal fade" id="editMaterialModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form method="POST" id="editMaterialForm">
      <div class="modal-header"><h5>Edit Material</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <input type="hidden" id="editMaterialId" name="material_id">
        <input id="editMaterialTitle" class="form-control mb-2" name="title" required>
        <input id="editMaterialFormInput" class="form-control mb-2" name="form" required>
        <input id="editMaterialSubject" class="form-control mb-2" name="subject" required>
        <input id="editMaterialLink" class="form-control mb-2" name="link" placeholder="Google Drive Link (Optional)">
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-warning">Update</button></div>
    </form>
  </div></div>
</div>

<div class="modal fade" id="deleteMaterialModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
    <form method="GET" id="deleteMaterialForm">
      <div class="modal-header bg-danger text-white"><h5>Confirm Delete</h5></div>
      <div class="modal-body text-center">
        <input type="hidden" id="deleteMaterialId">
        <p>Are you sure you want to delete <strong id="deleteMaterialTitleText"></strong>?</p>
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-danger">Delete</button></div>
    </form>
  </div></div>
</div>

<!-- Video Modals -->
<div class="modal fade" id="addVideoModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form action="{{ url_for('add_video') }}" method="POST">
      <div class="modal-header"><h5>Add Video</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <input class="form-control mb-2" name="title" placeholder="Title" required>
        <input class="form-control mb-2" name="form" placeholder="Form" required>
        <input class="form-control mb-2" name="subject" placeholder="Subject" required>
        <input class="form-control mb-2" name="link" placeholder="Google Drive Link" required>
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-primary">Save</button></div>
    </form>
  </div></div>
</div>

<div class="modal fade" id="editVideoModal" tabindex="-1">
  <div class="modal-dialog"><div class="modal-content">
    <form method="POST" id="editVideoForm">
      <div class="modal-header"><h5>Edit Video</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <input type="hidden" id="editVideoId" name="video_id">
        <input id="editVideoTitle" class="form-control mb-2" name="title" required>
        <input id="editVideoFormInput" class="form-control mb-2" name="form" required>
        <input id="editVideoSubject" class="form-control mb-2" name="subject" required>
        <input id="editVideoLink" class="form-control mb-2" name="link" required>
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-warning">Update</button></div>
    </form>
  </div></div>
</div>

<div class="modal fade" id="deleteVideoModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered"><div class="modal-content">
    <form method="GET" id="deleteVideoForm">
      <div class="modal-header bg-danger text-white"><h5>Confirm Delete</h5></div>
      <div class="modal-body text-center">
        <input type="hidden" id="deleteVideoId">
        <p>Are you sure you want to delete <strong id="deleteVideoTitleText"></strong>?</p>
      </div>
      <div class="modal-footer"><button type="submit" class="btn btn-danger">Delete</button></div>
    </form>
  </div></div>
</div>

<!-- JS for Modals -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // ====== LIVE CLASS MODALS ======
  var editClassModal = document.getElementById('editLiveClassModal');
  editClassModal.addEventListener('show.bs.modal', function (event) {
    var btn = event.relatedTarget;
    document.getElementById('editClassId').value = btn.getAttribute('data-id');
    document.getElementById('editClassTitle').value = btn.getAttribute('data-title');
    document.getElementById('editClassTime').value = btn.getAttribute('data-time');
    document.getElementById('editClassForm').value = btn.getAttribute('data-form');
    document.getElementById('editClassSubject').value = btn.getAttribute('data-subject');
    document.getElementById('editClassLink').value = btn.getAttribute('data-link');
    document.getElementById('editLiveClassForm').action = `/admin/live_class/edit/${btn.getAttribute('data-id')}`;
  });
  var deleteClassModal = document.getElementById('deleteLiveClassModal');
  deleteClassModal.addEventListener('show.bs.modal', function(event){
    var btn = event.relatedTarget;
    document.getElementById('deleteClassId').value = btn.getAttribute('data-id');
    document.getElementById('deleteClassTitleText').innerText = btn.getAttribute('data-title');
    document.getElementById('deleteLiveClassForm').action = `/admin/live_class/delete/${btn.getAttribute('data-id')}`;
  });

  // ====== MATERIAL MODALS ======
  var editMaterialModal = document.getElementById('editMaterialModal');
  editMaterialModal.addEventListener('show.bs.modal', function(event){
    var btn = event.relatedTarget;
    document.getElementById('editMaterialId').value = btn.getAttribute('data-id');
    document.getElementById('editMaterialTitle').value = btn.getAttribute('data-title');
    document.getElementById('editMaterialFormInput').value = btn.getAttribute('data-form');
    document.getElementById('editMaterialSubject').value = btn.getAttribute('data-subject');
    document.getElementById('editMaterialLink').value = btn.getAttribute('data-link');
    document.getElementById('editMaterialForm').action = `/admin/material/edit/${btn.getAttribute('data-id')}`;
  });
  var deleteMaterialModal = document.getElementById('deleteMaterialModal');
  deleteMaterialModal.addEventListener('show.bs.modal', function(event){
    var btn = event.relatedTarget;
    document.getElementById('deleteMaterialId').value = btn.getAttribute('data-id');
    document.getElementById('deleteMaterialTitleText').innerText = btn.getAttribute('data-title');
    document.getElementById('deleteMaterialForm').action = `/admin/material/delete/${btn.getAttribute('data-id')}`;
  });

  // ====== VIDEO MODALS ======
  var editVideoModal = document.getElementById('editVideoModal');
  editVideoModal.addEventListener('show.bs.modal', function(event){
    var btn = event.relatedTarget;
    document.getElementById('editVideoId').value = btn.getAttribute('data-id');
    document.getElementById('editVideoTitle').value = btn.getAttribute('data-title');
    document.getElementById('editVideoFormInput').value = btn.getAttribute('data-form');
    document.getElementById('editVideoSubject').value = btn.getAttribute('data-subject');
    document.getElementById('editVideoLink').value = btn.getAttribute('data-link');
    document.getElementById('editVideoForm').action = `/admin/video/edit/${btn.getAttribute('data-id')}`;
  });
  var deleteVideoModal = document.getElementById('deleteVideoModal');
  deleteVideoModal.addEventListener('show.bs.modal', function(event){
    var btn = event.relatedTarget;
    document.getElementById('deleteVideoId').value = btn.getAttribute('data-id');
    document.getElementById('deleteVideoTitleText').innerText = btn.getAttribute('data-title');
    document.getElementById('deleteVideoForm').action = `/admin/video/delete/${btn.getAttribute('data-id')}`;
  });
</script>
</body>
</html>
